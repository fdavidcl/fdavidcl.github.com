<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog - fdavidcl</title>
    <link rel="stylesheet" href="/assets/stylesheets/normalize.css">
    <link rel="stylesheet" href="/assets/stylesheets/default.css">
  </head>
  <body>
    <div class="wrapper pure-g">
      <aside class="sidebar">
        <div class="side-content">
          <header>
            <a class="name-box" href="/">
              <h1>David Charte</h1>
              <h3>fdavidcl</h3>
            </a>
            <img src="https://secure.gravatar.com/avatar/7083d161b041964b75c38376d9dee37a?s=200" class="profile-pic" />
          </header>
          <nav class="sections">
            
              <a href="/blog" class="section-link section-blog">blog</a>
            
            
              <a href="/research" class="section-link section-research">research</a>
            
              <a href="/projects" class="section-link section-projects">projects</a>
            
          </nav>
          <nav class="social-links">
            
              
              <a class="social-button Twitter-link" href="https://twitter.com/fdavidcl" title="Twitter"><!--
                --><i class="fa fa-twitter"></i><!--
              --></a>
            
              
              <a class="social-button Instagram-link" href="https://instagram.com/fdavidcl" title="Instagram"><!--
                --><i class="fa fa-instagram"></i><!--
              --></a>
            
              
              <a class="social-button Github-link" href="https://github.com/fdavidcl" title="Github"><!--
                --><i class="fa fa-github"></i><!--
              --></a>
            
              
              <a class="social-button LinkedIn-link" href="https://linkedin.com/in/fdavidcl" title="LinkedIn"><!--
                --><i class="fa fa-linkedin"></i><!--
              --></a>
            
              
              <a class="social-button Scholar-link" href="https://scholar.google.es/citations?user=FRv_MwYAAAAJ" title="Scholar"><!--
                --><i class="fa fa-graduation-cap"></i><!--
              --></a>
            
          </nav>
        </div>
      </aside>
      <div class="main">
        <div class="main-content">
          

  <article>
  <span class="date">05-05-2017</span>
  <a href="/blog/2017/05/05/emacs-lazy/"><h1>Emacs for lazy people</h1></a>

  <p>Emacs is one of the most powerful, extensible editors out there.
However, learning to use it is not an easy task, and I’m just really
lazy. The following are some packages that I hope will make your life
way easier. And if you already use Emacs, I encourage you to try them
and see if they help you get a more comfortable development environment.</p>

<p>To add any of these packages to your Emacs configuration, find your 
initialization file (usually <code class="highlighter-rouge">~/.emacs</code> or <code class="highlighter-rouge">~/.emacs.d/init.el</code>) and
add the snippets there. You will also need to install and enable <code class="highlighter-rouge">use-package</code> 
beforehand (<a href="http://www.lunaryorn.com/posts/my-emacs-configuration-with-use-package.html">why?</a>).</p>

<h2 id="smex">Smex</h2>

<p>In Emacs we use M-x
(<kbd>Alt</kbd>+<kbd>X</kbd>) to enter any
command without the need for a dedicated keyboard shortcut or menu
entry. By default Emacs doesn’t help much while writing a command, and
it can be challenging to remember many of them, as well as tedious
writing the long ones (<code class="highlighter-rouge">package-list-packages</code> anyone?).
<a href="https://github.com/nonsequitur/smex/">Smex</a> is a M-x enhancement for
Emacs, built on top of Ido, which means it will try to predict and
autocomplete commands as you write them.</p>

<p>In order to install and enable Smex, add the following code to your
initialization file:</p>

<div class="language-common_lisp highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="nb">use-package</span> <span class="nv">smex</span>
<span class="ss">:config</span> <span class="p">(</span><span class="nv">smex-initialize</span><span class="p">))</span>
</code></pre>
</div>

<h2 id="ergoemacs">Ergoemacs</h2>

<p>If you’re just starting to use emacs, you may find it difficult to learn
all the new keybindings. If you’re a long-time user, you may have
experienced repetitive strain injury (RSI), also known as <a href="https://en.wikipedia.org/wiki/Emacs#Emacs_pinky">Emacs
pinky</a>. Don’t worry,
I’ve got just the solution for you:
<a href="https://ergoemacs.github.io/index.html">ergoemacs-mode</a> is a minor-mode
that sets ergonomic and well-known keybindings for common editing
functions, with the aim of reducing RSI as well as adding some
familiarity to the use of emacs.</p>

<p>Just as before, add the following code to your initialization file and
restart Emacs to use it:</p>

<div class="language-common_lisp highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="nb">use-package</span> <span class="nv">ergoemacs-mode</span>
<span class="ss">:init</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">ergoemacs-theme</span> <span class="no">nil</span><span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">ergoemacs-keyboard-layout</span> <span class="s">"es"</span><span class="p">)</span>
<span class="ss">:config</span>
  <span class="p">(</span><span class="nv">ergoemacs-mode</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
</code></pre>
</div>

<p>You can check <a href="https://ergoemacs.github.io/key-setup.html">your new keybinding
layout</a>. Remember that,
after enabling Ergoemacs, the keyboard shortcut that allows you to enter
a custom command becomes
<kbd>Alt</kbd>+<kbd>A</kbd>.</p>

<h2 id="which-key">Which-key</h2>

<p><img src="/assets/images/emacs-which-key.png" alt="" /></p>

<p><a href="https://github.com/justbur/emacs-which-key">Which-key</a> displays the key
bindings following your currently entered incomplete command. That way,
when you can’t remember which key to press, you’ll have a cheat sheet in
a couple of seconds.</p>

<div class="language-common_lisp highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="nb">use-package</span> <span class="nv">which-key</span>
<span class="ss">:config</span> <span class="p">(</span><span class="nv">which-key-mode</span><span class="p">))</span>
</code></pre>
</div>

<h2 id="auto-reload-stuff">Auto-reload stuff</h2>

<p>When using version control, files generally change while having them
open in the editor. If this happens, I expect my editor to refresh the
files so that I don’t write on an old version. Emacs doesn’t enable this
behavior by default, rather letting the user decide if they want to
reload files. Instead, we can set it to automatically reload files from
disk when changed via these configuration lines (source: <a href="http://pragmaticemacs.com/emacs/automatically-revert-buffers/">Pragmatic
Emacs</a>):</p>

<div class="language-common_lisp highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="nv">global-auto-revert-mode</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'dired-mode-hook</span> <span class="ss">'auto-revert-mode</span><span class="p">)</span>
</code></pre>
</div>

<h2 id="still-want-more">Still want more?</h2>

<p>These are the main tools that have eased my way into Emacs. You can check out the rest of my configuration in <a href="https://github.com/fdavidcl/dotfiles/tree/master/emacs">my dotfiles repository</a>.</p>


  <div class="tags">
    
      <a href="/tag/emacs">emacs</a>
    
      <a href="/tag/linux">linux</a>
    
  </div>
</article>


  <article>
  <span class="date">05-03-2017</span>
  <a href="/blog/2017/03/05/sincronizar-org/"><h1>Sincronizando notas entre PC y móvil mediante Orgzly y Syncthing</h1></a>

  <p>Uno de los sistemas más versátiles que existen para organización personal y gestión de tareas es <em>org-mode</em> de Emacs, un modo de este editor que proporciona comodidades útiles tanto para tomar notas rápidas como incluso <a href="https://m42.github.io/blog/2016/09/26/matematicas-en-emacs/">escribir unos apuntes con fórmulas matemáticas</a>. Esencialmente, aunque cuesta trabajo empezar a usarlo, tiene más utilidades y plugins que la mayoría de <a href="https://www.amazon.com/Wenger-16999-Swiss-Knife-Giant/product-reviews/B001DZTJRQ/ref=cm_cr_arp_d_viewopt_rvwer?pageNumber=1&amp;filterByStar=positive&amp;reviewerType=all_reviews">navajas suizas</a>, por lo que no es muy difícil encontrar una forma cómoda de aprovechar unas cuantas para organizarse.</p>

<p>Para llevar un sistema basado en <em>org</em> en el móvil existe <a href="http://www.orgzly.com/">Orgzly</a>, una aplicación de Android que da una interfaz intuitiva mediante botones y gestos, pero que internamente utiliza el formato de <em>org</em>.</p>

<p class="fig medium"><img src="/assets/images/orgzly.png" alt="" />
Orgzly en funcionamiento</p>

<p>La pregunta que nos vendría a la mente a todos sería si podemos tener el mismo archivo de <em>org</em> sincronizado entre nuestros dispositivos con Emacs y Orgzly. El problema al que llegamos es que el único sistema de sincronización que ofrece Orgzly es a través de Dropbox y, aparte de las preocupaciones por seguridad y privacidad que nos podrían surgir, en realidad es totalmente innecesario tener nuestro archivo almacenado en la nube.</p>

<p>La solución que he encontrado es usar <a href="https://syncthing.net/">Syncthing, un sistema de sincronización P2P de código libre</a>. Para ello simplemente tendremos que instalar la app de Syncthing en los dispositivos Android y la versión del programa correspondiente a nuestro sistema operativo para el PC.</p>

<p class="note">En Arch Linux basta ejecutar <code class="highlighter-rouge">pacman -S syncthing</code>. Además, conviene añadirlo al arranque del sistema con <code class="highlighter-rouge">systemctl --user enable syncthing</code>.</p>

<p>En la versión de PC, Syncthing generalmente inicializará una carpeta por defecto. Podemos mover ahí nuestro archivo <em>org</em>. Para hacer que se comuniquen los dispositivos entre sí, desde la interfaz web disponible en <code class="highlighter-rouge">localhost:8384</code> mostramos el ID desde <em>Options</em> → <em>Show ID</em> y escaneamos el código QR desde el móvil en la pantalla de <em>Nuevo dispositivo</em>.</p>

<p class="fig medium"><img src="/assets/images/syncthing-add.jpg" alt="" /></p>

<p>Una vez hecho esto, la app avisará de que el PC quiere comenzar a sincronizar la carpeta por defecto. Aceptamos la solicitud y asignamos una ruta dentro de los archivos del teléfono, para almacenar esa carpeta. Syncthing descargará en esa ubicación los archivos que hayamos copiado en el ordenador, y los volverá a enviar a este cuando realicemos cambios.</p>

<p class="fig medium"><img src="/assets/images/syncthing-pc.png" alt="" /></p>

<p>El último paso es configurar a Orgzly para que lea y escriba de esa carpeta. Para esto entramos en la configuración de la aplicación, y bajo <em>Sync</em> seleccionamos <em>Repositories</em> → <em>Directory</em>. Escogemos la ruta que definimos antes para el almacenamiento de Syncthing. A partir de ahora, Orgzly guardará en ese directorio los archivos <em>org</em> que cree, y leerá los nuevos archivos que aparezcan.</p>

<p class="fig medium"><img src="/assets/images/orgzly-repos.jpg" alt="" /></p>

<p>Por último, Syncthing permite sincronizar datos entre muchos dispositivos y ser relativamente selectivo en cuanto a qué se sincroniza con cada uno. Así, nuestros archivos de <em>org</em> pueden estar siempre actualizados vayamos donde vayamos, y sin necesidad de almacenarlos permanentemente en servidores externos.</p>



  <div class="tags">
    
      <a href="/tag/emacs">emacs</a>
    
      <a href="/tag/trucos">trucos</a>
    
      <a href="/tag/android">android</a>
    
      <a href="/tag/syncthing">syncthing</a>
    
  </div>
</article>


  <article>
  <span class="date">28-01-2017</span>
  <a href="/blog/2017/01/28/aproximadores-ruby/"><h1>Métodos de aproximación en Ruby</h1></a>

  <p>Entre las tareas de una práctica para la asignatura de Mecánica
Celeste (todo
el
<a href="https://github.com/fdavidcl/celeste">código disponible en GitHub</a>),
he tenido que programar un par de métodos numéricos de aproximación
iterativos. Resultó ser una aplicación muy práctica de los
<a href="http://tux.ugr.es/libreim/blog/2015/08/24/ruby-enumerators/">enumerables de Ruby</a> y
me parece un buen ejemplo del ahorro de código que puede suponer su uso.</p>

<p>Para abstraer distintos métodos iterativos de aproximación, definí una
clase abstracta <code class="highlighter-rouge">Approximator</code> de la que derivarían el resto. Permite
almacenar la aproximación actual y la tolerancia o error que se quiera
aceptar. Las clases derivadas implementan el método <code class="highlighter-rouge">next_one</code> que
calcula la siguiente aproximación a partir de la actual.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># Clase base para métodos numéricos de aproximación de funciones</span>
<span class="k">class</span> <span class="nc">Approximator</span>

  <span class="c1"># Datos miembro</span>
  <span class="c1">#  - current:   valor de la aproximación actual</span>
  <span class="c1">#  - tolerance: valor de tolerancia</span>
  <span class="kp">attr_accessor</span> <span class="ss">:current</span><span class="p">,</span> <span class="ss">:tolerance</span>
  
  <span class="k">def</span> <span class="nf">initialize</span> <span class="n">initial</span><span class="p">,</span> <span class="n">tolerance</span> <span class="o">=</span> <span class="no">DEFAULT_TOLERANCE</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">current</span> <span class="o">=</span> <span class="n">initial</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">tolerance</span> <span class="o">=</span> <span class="n">tolerance</span>
  <span class="k">end</span>

  <span class="c1"># Método a implementar en las clases hijas</span>
  <span class="k">def</span> <span class="nf">next_one</span>
    <span class="k">raise</span> <span class="no">NotImplementedError</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>El punto clave para aprovechar la potencia de los enumeradores es
implementar un método <code class="highlighter-rouge">each</code> que haga uso de la función <code class="highlighter-rouge">yield</code> para
proporcionar los resultados parciales. En este caso, proporciona la
aproximación encontrada en cada iteración. Lo interesante de <code class="highlighter-rouge">yield</code>
es que no devuelve el control al método hasta que se necesita un nuevo
resultado, de forma que sólo se realizan los cálculos necesarios. Por
ejemplo, podría haber implementado (y lo hice, al principio) el método
<code class="highlighter-rouge">each</code> como un <code class="highlighter-rouge">loop</code> infinito, sin condición de parada, y podría
iterar las veces necesarias para obtener una precisión arbitraria
(suponiendo convergencia del método). Sin embargo, para poder hacer un
uso práctico de las clases, añadí la condición de parada con la
tolerancia.</p>

<p>Una vez implementado <code class="highlighter-rouge">each</code>, basta con incluir el módulo <code class="highlighter-rouge">Enumerable</code>
que añade toda la funcionalidad de los enumeradores, como <code class="highlighter-rouge">to_a</code> que
acumula en un array todos los elementos devueltos por <code class="highlighter-rouge">each</code>. Así,
para calcular la mejor aproximación basta con devolver el último
elemento de ese array.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Approximator</span>
  <span class="c1"># Método que calcula y proporciona aproximaciones</span>
  <span class="k">def</span> <span class="nf">each</span>
    <span class="n">previous</span> <span class="o">=</span> <span class="no">Float</span><span class="o">::</span><span class="no">INFINITY</span>
    <span class="k">until</span> <span class="p">(</span><span class="n">current</span> <span class="o">-</span> <span class="n">previous</span><span class="p">).</span><span class="nf">abs</span> <span class="o">&lt;</span> <span class="n">tolerance</span>
      <span class="c1"># Proporciona una aproximación y espera a que se</span>
      <span class="c1"># pida la siguiente</span>
      <span class="k">yield</span> <span class="n">current</span>
      <span class="n">previous</span> <span class="o">=</span> <span class="n">current</span>
      <span class="nb">self</span><span class="p">.</span><span class="nf">current</span> <span class="o">=</span> <span class="n">next_one</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="c1"># Incluimos herramientas que permiten enumerar</span>
  <span class="c1"># las aproximaciones</span>
  <span class="kp">include</span> <span class="no">Enumerable</span>

  <span class="c1"># Método que devuelve la última aproximación</span>
  <span class="c1"># para la tolerancia dada</span>
  <span class="k">def</span> <span class="nf">approximate</span>
    <span class="nb">to_a</span><span class="p">.</span><span class="nf">last</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Además de consultar la mejor aproximación, podremos realizar otras
tareas como obtener una lista de <em>n</em> iteraciones con <code class="highlighter-rouge">take(n)</code>.</p>

<p>Por último, basta implementar especializaciones de esta clase con
métodos de aproximación concretos. El siguiente es el método de
Newton-Raphson, que permite calcular raíces de funciones a partir de
sucesivas evaluaciones en la función y en su derivada.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">NewtonRaphson</span> <span class="o">&lt;</span> <span class="no">Approximator</span>
  <span class="c1"># Datos miembro</span>
  <span class="c1">#  - function:   almacena la función f</span>
  <span class="c1">#  - derivative: almacena la derivada de f</span>
  <span class="kp">attr_accessor</span> <span class="ss">:function</span><span class="p">,</span> <span class="ss">:derivative</span>
  
  <span class="k">def</span> <span class="nf">initialize</span> <span class="n">initial</span><span class="p">,</span> <span class="n">tolerance</span> <span class="o">=</span> <span class="no">DEFAULT_TOLERANCE</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">derivative</span>
    <span class="k">super</span><span class="p">(</span><span class="n">initial</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">)</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">function</span> <span class="o">=</span> <span class="n">function</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">derivative</span> <span class="o">=</span> <span class="n">derivative</span>
  <span class="k">end</span>
  
  <span class="k">def</span> <span class="nf">next_one</span>
    <span class="c1"># Método de Newton-Raphson para encontrar raíces:</span>
    <span class="c1"># Calcula Φ(current) = current - f(current)/f'(current)</span>
    <span class="n">current</span> <span class="o">-</span> <span class="n">function</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">current</span><span class="p">)</span><span class="o">/</span><span class="n">derivative</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Un ejemplo de uso de esta implementación sería el cálculo de la raíz
cuadrada de 5, como la raíz del polinomio correspondiente:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">example</span> <span class="o">=</span> <span class="no">NewtonRaphson</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span>
  <span class="mi">3</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span>
  <span class="o">-&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">5</span> <span class="p">},</span>
  <span class="o">-&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="p">}</span>
<span class="p">)</span>
<span class="n">example</span><span class="p">.</span><span class="nf">approximate</span>
<span class="c1">#=&gt; 2.23606797749979</span>
</code></pre>
</div>

<p>Otra especialización es la aproximación de la suma de una serie
convergente, a partir de una función que evalúe el n-ésimo término:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">SeriesApproximator</span> <span class="o">&lt;</span> <span class="no">Approximator</span>

  <span class="c1"># Datos miembro</span>
  <span class="c1">#  - term: función que evalúa el término n-ésimo de la serie</span>
  <span class="c1">#  - n: índice del término actual se la serie</span>
  <span class="kp">attr_accessor</span> <span class="ss">:term</span><span class="p">,</span> <span class="ss">:n</span>
  
  <span class="k">def</span> <span class="nf">initialize</span> <span class="n">tolerance</span> <span class="o">=</span> <span class="no">DEFAULT_TOLERANCE</span><span class="p">,</span> <span class="n">term</span>
    <span class="k">super</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">)</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">term</span> <span class="o">=</span> <span class="n">term</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">n</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">end</span>

  <span class="c1"># Calcula el siguiente término de la serie y lo suma a</span>
  <span class="c1"># la aproximación actual</span>
  <span class="k">def</span> <span class="nf">next_one</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">current</span> <span class="o">+=</span> <span class="n">term</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Podemos usarla para calcular la suma de Σ1/2^n:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">series</span> <span class="o">=</span> <span class="no">SeriesApproximator</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="mi">2</span><span class="o">**</span><span class="n">n</span> <span class="p">})</span>
<span class="n">series</span><span class="p">.</span><span class="nf">approximate</span>
<span class="c1">#=&gt; 0.999999999998181</span>
</code></pre>
</div>

<p>En particular, las sumas de series nos pueden permitir aproximar los
valores de algunas funciones en diversos puntos, utilizando
por ejemplo <a href="https://en.wikipedia.org/wiki/Fourier_series">desarrollos de Fourier</a>.</p>

<p>Y si habéis leído hasta aquí, ¡gracias! Espero que os haya parecido útil
y os sirva para aprovechar los enumerables en otros proyectos.</p>


  <div class="tags">
    
      <a href="/tag/programacion">programacion</a>
    
      <a href="/tag/ruby">ruby</a>
    
      <a href="/tag/math">math</a>
    
  </div>
</article>


  <article>
  <span class="date">22-08-2016</span>
  <a href="/blog/2016/08/22/jekyll-formularios/"><h1>Un sistema de contribuciones a blogs Jekyll para gente sin conocimientos de Jekyll, GitHub o Markdown</h1></a>

  <p>Durante un tiempo, los colaboradores del <a href="http://tux.ugr.es/dgiim/blog">blog de LibreIM</a> hemos tenido que componer los posts prácticamente a mano, haciendo uso de un editor de texto para escribirlos, Git para llevar el registro de cambios y una <em>pull request</em> en GitHub para enviar el post, revisarlo y corregirlo. Evidentemente, este puede ser un proceso ideal para desarrolladores acostumbrados al proceso, pero está lejos de ser perfecto cuando tratamos de mantener un blog colaborativo abierto a que cualquiera publique su conocimiento. Lo que buscamos es una forma de abstraer el proceso de edición y envío de posts para hacer el blog accesible a mucha más gente.</p>

<p>La solución que concebimos consta de dos partes: por un lado, un backend que utilizaría una cuenta <em>bot</em> de GitHub para la gestión automática de ramas y <em>pull requests</em>; por otro, una aplicación web con un formulario y un sencillo editor desde la que se enviarían los posts.</p>

<p class="fig"><img src="/assets/images/jekyll-form.png" alt="Formulario resultante" />
Un ejemplo del <a href="http://tux.ugr.es/dgiim/new/post">formulario resultante</a></p>

<h2 id="preparativos-previos">Preparativos previos</h2>

<p>Para crear nuevos <em>commits</em> y <em>pull requests</em> necesitamos una cuenta de GitHub. Podemos usar la propia o crear una nueva. Otorgaremos a dicha cuenta permisos de escritura sobre el repositorio de blog en cuestión. Después, obtendremos un <a href="https://github.com/settings/tokens">token de acceso personal</a> con permisos de modificación de repositorios. Dicho token lo almacenaremos en las variables de entorno de la shell donde vayamos a hospedar la aplicación, supongamos que bajo el nombre de <code class="highlighter-rouge">GITHUB_TOKEN</code>.</p>

<h2 id="el-backend">El backend</h2>

<p>Componer un guion que trabaje con Git automáticamente no es muy complicado. Se podría utilizar directamente un guion de Bash pero, en vistas a integrarlo en la aplicación web, usamos la <a href="https://rubygems.org/gems/git">gema git</a> para Ruby. Esta permite realizar todo tipo de operaciones sobre repositorios Git, a nosotros nos basta con clonar, abrir una nueva rama, incluir un nuevo archivo en un <em>commit</em> y enviarlo al repositorio remoto. El siguiente código Ruby define una función que realiza todo el proceso, notemos cómo se obtiene por parámetro un <em>block</em> (similar a una función anónima) que permite realizar las modificaciones pertinentes al repositorio:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># repo.rb</span>
<span class="nb">require</span> <span class="s1">'fileutils'</span>
<span class="nb">require</span> <span class="s1">'git'</span>

<span class="k">def</span> <span class="nf">modify_repo</span> <span class="n">repo</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="n">commit_msg</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span>
  <span class="n">dir</span> <span class="o">=</span> <span class="s2">".repo"</span>

  <span class="c1"># Usamos el token de acceso para clonar el repositorio</span>
  <span class="n">g</span> <span class="o">=</span> <span class="no">Git</span><span class="p">.</span><span class="nf">clone</span><span class="p">(</span><span class="s2">"https://</span><span class="si">#{</span><span class="no">ENV</span><span class="p">[</span><span class="s2">"GITHUB_TOKEN"</span><span class="p">]</span><span class="si">}</span><span class="s2">@github.com/</span><span class="si">#{</span><span class="n">repo</span><span class="si">}</span><span class="s2">.git"</span><span class="p">,</span> <span class="n">dir</span><span class="p">)</span>

  <span class="c1"># Configuramos el email y nombre de la cuenta bot</span>
  <span class="n">g</span><span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="s2">"user.name"</span><span class="p">,</span> <span class="s2">"BOT"</span><span class="p">)</span>
  <span class="n">g</span><span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="s2">"user.email"</span><span class="p">,</span> <span class="s1">'BOT_EMAIL@example.org'</span><span class="p">)</span>

  <span class="c1"># Creamos una rama nueva</span>
  <span class="n">g</span><span class="p">.</span><span class="nf">branch</span><span class="p">(</span><span class="n">head</span><span class="p">).</span><span class="nf">checkout</span>

  <span class="c1"># Realizamos modificaciones en el repo</span>
  <span class="n">g</span><span class="p">.</span><span class="nf">chdir</span> <span class="p">{</span> <span class="n">block</span><span class="p">.</span><span class="nf">call</span> <span class="p">}</span>

  <span class="c1"># Commit y push</span>
  <span class="n">g</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="ss">all: </span><span class="kp">true</span><span class="p">)</span>
  <span class="n">g</span><span class="p">.</span><span class="nf">commit</span><span class="p">(</span><span class="s2">"</span><span class="si">#{</span><span class="n">commit_msg</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
  <span class="n">g</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="s2">"origin"</span><span class="p">,</span> <span class="n">head</span><span class="p">)</span>

  <span class="no">FileUtils</span><span class="p">.</span><span class="nf">rm_rf</span><span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Ahora hemos de añadir la capacidad de crear <em>pull requests</em>, para ello usamos la <a href="https://rubygems.org/gems/octokit">gema octokit</a>, que acepta el token de acceso que obtuvimos antes:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># form.rb</span>
<span class="nb">require</span> <span class="s1">'octokit'</span>
<span class="nb">require_relative</span> <span class="s1">'repo'</span>

<span class="n">github</span> <span class="o">=</span> <span class="no">Octokit</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:access_token</span> <span class="o">=&gt;</span> <span class="no">ENV</span><span class="p">[</span><span class="s2">"GITHUB_TOKEN"</span><span class="p">])</span>

<span class="n">repo</span> <span class="o">=</span> <span class="s2">"BOT/blog"</span>
<span class="n">base</span> <span class="o">=</span> <span class="s2">"gh-pages"</span>
<span class="n">head</span> <span class="o">=</span> <span class="s2">"new-post"</span>

<span class="n">modify_repo</span> <span class="n">repo</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="s2">"Nuevo post"</span> <span class="k">do</span>
  <span class="c1"># Creación del nuevo post</span>
<span class="k">end</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">github</span><span class="p">.</span><span class="nf">create_pull_request</span><span class="p">(</span><span class="n">repo</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="s2">"Nuevo post"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
</code></pre>
</div>

<p>Únicamente nos queda obtener del usuario los datos necesarios para crear un nuevo post: un titulo, un autor, una categoría y el contenido.</p>

<h2 id="el-formulario">El formulario</h2>

<h3 id="sinatra">Sinatra</h3>

<p><a href="http://www.sinatrarb.com/">Sinatra</a> es un <em>domain specific language</em> (DSL) para Ruby que facilita la creación de aplicaciones web sencillas sin apenas esfuerzo. Basta con escribir las peticiones HTTP que se aceptan y cuál es la respuesta. Además, es muy útil utilizarlo junto a otras gemas de Ruby que ahorren trabajo a la hora de escribir las plantillas y el estilo. Nuestro archivo de dependencias <code class="highlighter-rouge">Gemfile</code> queda de la siguiente forma:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># Gemfile</span>

<span class="n">source</span> <span class="s1">'https://rubygems.org'</span>

<span class="n">gem</span> <span class="s1">'sinatra'</span>
<span class="n">gem</span> <span class="s1">'sinatra-contrib'</span>
<span class="n">gem</span> <span class="s1">'thin'</span>      <span class="c1"># Web server</span>
<span class="n">gem</span> <span class="s1">'haml'</span>      <span class="c1"># For layouts</span>
<span class="n">gem</span> <span class="s1">'sass'</span>      <span class="c1"># For stylesheets</span>
<span class="n">gem</span> <span class="s1">'kramdown'</span>  <span class="c1"># For the preview</span>
<span class="n">gem</span> <span class="s1">'rouge'</span>     <span class="c1"># For syntax highlighting</span>
<span class="n">gem</span> <span class="s1">'octokit'</span>   <span class="c1"># For pull requests</span>
<span class="n">gem</span> <span class="s1">'git'</span>       <span class="c1"># Repo management</span>
<span class="n">gem</span> <span class="s1">'recaptcha'</span> <span class="c1"># Some protection against bots</span>
</code></pre>
</div>

<p>Para instalar y manejar las dependencias usamos <a href="http://bundler.io/">Bundler</a>: basta así con ejecutar <code class="highlighter-rouge">gem install bundler</code> y tras esto <code class="highlighter-rouge">bundle install</code>.</p>

<h3 id="respondiendo-a-peticiones">Respondiendo a peticiones</h3>

<p>Vamos a ampliar el archivo <code class="highlighter-rouge">form.rb</code> creado anteriormente para aceptar y responder un par de peticiones HTTP. Responderemos a <code class="highlighter-rouge">GET /</code> mostrando el formulario, que crearemos aparte en una vista en Haml. Por otro lado, al enviar dicho formulario se creará una petición <code class="highlighter-rouge">POST /posts</code> con los datos que necesitamos para componer el nuevo post.</p>

<div class="language-haml highlighter-rouge"><pre class="highlight"><code><span class="c">-# views/form.haml
</span><span class="nt">%h1</span> Nuevo post
<span class="nt">%form</span><span class="p">{</span><span class="ss">action: </span><span class="s2">"/posts"</span><span class="p">,</span> <span class="ss">method: </span><span class="s2">"post"</span><span class="p">}</span>
  <span class="nt">%input</span><span class="p">{</span><span class="ss">type: </span><span class="s2">"text"</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"title"</span><span class="p">,</span> <span class="ss">placeholder: </span><span class="s2">"Título"</span><span class="p">}</span>
  <span class="nt">%input</span><span class="p">{</span><span class="ss">type: </span><span class="s2">"text"</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"author"</span><span class="p">,</span> <span class="ss">placeholder: </span><span class="s2">"Autor 1, Autor 2, ..."</span><span class="p">}</span>
  <span class="nt">%input</span><span class="p">{</span><span class="ss">type: </span><span class="s2">"text"</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"category"</span><span class="p">,</span> <span class="ss">placeholder: </span><span class="s2">"Categoría"</span><span class="p">}</span>
  <span class="nt">%textarea</span><span class="p">{</span><span class="ss">name: </span><span class="s2">"content"</span><span class="p">,</span> <span class="ss">placeholder: </span><span class="s2">"Contenido"</span><span class="p">}</span>
  <span class="nt">%input</span><span class="p">{</span><span class="ss">type: </span><span class="s2">"submit"</span><span class="p">,</span> <span class="ss">value: </span><span class="s2">"Enviar"</span><span class="p">}</span>
</code></pre>
</div>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># form.rb</span>
<span class="nb">require</span> <span class="s1">'rubygems'</span>
<span class="nb">require</span> <span class="s1">'bundler'</span>
<span class="no">Bundler</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:default</span><span class="p">)</span>
<span class="nb">require_relative</span> <span class="s2">"repo"</span>

<span class="n">get</span> <span class="s2">"/"</span> <span class="k">do</span>
  <span class="c1"># Mostramos el formulario</span>
  <span class="n">haml</span> <span class="ss">:form</span>
<span class="k">end</span>

<span class="n">post</span> <span class="s2">"/posts/?"</span> <span class="k">do</span>
  <span class="c1"># Obtenemos los datos</span>
  <span class="n">title</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:title</span><span class="p">]</span>
  <span class="n">author</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:author</span><span class="p">]</span>
  <span class="n">content</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:content</span><span class="p">]</span>
  <span class="n">category</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:category</span><span class="p">]</span> <span class="o">||</span> <span class="s2">"unclassified"</span>

  <span class="c1"># Creamos el nombre del archivo</span>
  <span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">today</span><span class="p">.</span><span class="nf">strftime</span> <span class="s2">"%Y-%m-%d"</span>
  <span class="n">filename</span> <span class="o">=</span> <span class="n">title</span><span class="p">.</span><span class="nf">downcase</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s2">" "</span><span class="p">)[</span><span class="mi">0</span><span class="p">.</span><span class="nf">.</span><span class="mi">4</span><span class="p">].</span><span class="nf">join</span><span class="p">(</span><span class="s2">"-"</span><span class="p">)</span>

  <span class="n">github</span> <span class="o">=</span> <span class="no">Octokit</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:access_token</span> <span class="o">=&gt;</span> <span class="no">ENV</span><span class="p">[</span><span class="s2">"GITHUB_TOKEN"</span><span class="p">])</span>

  <span class="n">repo</span> <span class="o">=</span> <span class="s2">"BOT/blog"</span>
  <span class="n">base</span> <span class="o">=</span> <span class="s2">"gh-pages"</span>
  <span class="n">head</span> <span class="o">=</span> <span class="s2">"new-post-</span><span class="si">#{</span><span class="n">filename</span><span class="si">}</span><span class="s2">"</span>

  <span class="n">modify_repo</span> <span class="n">repo</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="s2">"Nuevo post"</span> <span class="k">do</span>
    <span class="c1"># Creamos el archivo del post</span>
    <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s2">"_posts/</span><span class="si">#{</span><span class="n">date</span><span class="si">}</span><span class="s2">-</span><span class="si">#{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.md"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">write</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
---
layout: post
title: </span><span class="si">#{</span><span class="n">title</span><span class="si">}</span><span class="sh">
authors: </span><span class="si">#{</span><span class="n">author</span><span class="p">.</span><span class="nf">split</span> <span class="sr">/,\s*/</span><span class="si">}</span><span class="sh">
category: </span><span class="si">#{</span><span class="n">category</span><span class="si">}</span><span class="sh">
---

</span><span class="si">#{</span><span class="n">content</span><span class="si">}</span><span class="sh">
</span><span class="no">EOF</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">response</span> <span class="o">=</span> <span class="n">github</span><span class="p">.</span><span class="nf">create_pull_request</span><span class="p">(</span><span class="n">repo</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="s2">"Nuevo post"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Para iniciar el servidor web con nuestra aplicación, debería bastar con ejecutar <code class="highlighter-rouge">ruby form.rb</code> en el terminal.</p>

<h3 id="aadiendo-un-editor-de-verdad">Añadiendo un editor de verdad</h3>

<p>Todo esto ya está muy bien, y la aplicación ahorra un montón de esfuerzo para cada vez que se crea un nuevo post. Pero aún queda una barrera que evitaría que algunos usuarios estuvieran cómodos escribiendo: el marcado de formato con Markdown. Existen diversos editores Markdown que pueden incrustarse en una página web, algunos con amplias funcionalidades y otros más sencillos. Nosotros optamos por <a href="https://simplemde.com/">SimpleMDE</a>, que facilita la escritura mediante algunas pistas visuales en el código y unos botones que dan acceso a la mayoría de opciones de formato de Markdown.</p>

<p>Este editor aporta además una opción de previsualización personalizable, lo que quiere decir que podemos modificar la forma en que se compila el código Markdown y se muestra dicha vista previa. Como los blogs Jekyll usan el intérprete <a href="http://kramdown.gettalong.org/">Kramdown</a> por defecto, podemos añadir una ruta al servidor que compile un documento mediante esta herramienta. Además, utilizamos también la gema <a href="http://rouge.jneen.net/">Rouge</a> para resaltado de código.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># form.rb</span>
<span class="c1"># ...</span>
<span class="n">post</span> <span class="s2">"/preview/?"</span> <span class="k">do</span>
  <span class="no">Kramdown</span><span class="o">::</span><span class="no">Document</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:content</span><span class="p">],</span> <span class="ss">syntax_highlighter: :rouge</span><span class="p">).</span><span class="nf">to_html</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Por otro lado, el editor habrá que inicializarlo mediante un código similar al siguiente:</p>

<div class="language-haml highlighter-rouge"><pre class="highlight"><code><span class="nt">%form</span><span class="p">{</span><span class="ss">action: </span><span class="s2">"/posts"</span><span class="p">,</span> <span class="ss">method: </span><span class="s2">"post"</span><span class="p">}</span>
  <span class="c">-# ...
</span>  <span class="nt">%textarea</span><span class="nf">#markdown_editor</span><span class="p">{</span><span class="ss">name: </span><span class="s2">"content"</span><span class="p">,</span> <span class="ss">placeholder: </span><span class="s2">"Contenido"</span><span class="p">}</span>

<span class="nt">%link</span><span class="p">{</span><span class="ss">rel: </span><span class="s2">"stylesheet"</span><span class="p">,</span> <span class="ss">href: </span><span class="s2">"https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css"</span><span class="p">}</span>
<span class="nt">%script</span><span class="p">{</span><span class="ss">src: </span><span class="s2">"https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"</span><span class="p">}</span>
<span class="nd">:javascript
</span>  <span class="c1">// La típica función para peticiones AJAX</span>
  <span class="kd">function</span> <span class="nx">AjaxRequest</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">xmlhttp</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">XMLHttpRequest</span><span class="p">)</span>
      <span class="nx">xmlhttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
    <span class="k">else</span>
      <span class="nx">xmlhttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ActiveXObject</span><span class="p">(</span><span class="s2">"Microsoft.XMLHTTP"</span><span class="p">);</span>

    <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">responseXML</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">responseXML</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">method</span> <span class="o">==</span> <span class="s2">"POST"</span><span class="p">)</span>
      <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">"Content-type"</span><span class="p">,</span> <span class="s2">"application/x-www-form-urlencoded"</span><span class="p">);</span>

    <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Inicializa el editor Markdown con algunas opciones extra</span>
  <span class="kd">var</span> <span class="nx">simplemde</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimpleMDE</span><span class="p">({</span>
    <span class="na">element</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"markdown_editor"</span><span class="p">),</span>
    <span class="na">blockStyles</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">code</span><span class="p">:</span> <span class="s2">"~~~"</span>
    <span class="p">},</span>
    <span class="c1">// Usa el sistema propio para vista previa (kramdown + rouge)</span>
    <span class="na">previewRender</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">plainText</span><span class="p">,</span> <span class="nx">preview</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Esperar un segundo sin cambios para hacer la petición</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">delay</span><span class="p">)</span>
        <span class="nx">clearTimeout</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">delay</span><span class="p">);</span>

      <span class="nb">window</span><span class="p">.</span><span class="nx">delay</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">AjaxRequest</span><span class="p">(</span><span class="s2">"/preview"</span><span class="p">,</span> <span class="s2">"POST"</span><span class="p">,</span> <span class="s2">"content="</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">plainText</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">// `preview` es el nodo que contiene la vista previa</span>
          <span class="nx">preview</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">response</span><span class="p">;</span>
        <span class="p">});</span>
      <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>

      <span class="k">return</span> <span class="nx">preview</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span>
</code></pre>
</div>

<p>Ahora sí, con todo esto tenemos un editor que facilita la tarea de escribir un post a cualquiera.</p>

<h2 id="los-extras">Los extras</h2>

<p>Un par de funcionalidades adicionales que hemos utilizado en <a href="http://tux.ugr.es/dgiim/new/post">el formulario para LibreIM</a> son la inclusión de <a href="http://mathjax.org/">MathJax</a> para interpretar fórmulas en LaTeX, y de un CAPTCHA mediante la gema <a href="https://rubygems.org/gems/recaptcha/">recaptcha</a>. No entro aquí en más detalle porque son fáciles de usar; además, todo nuestro código está <a href="https://github.com/libreim/form-im">publicado en GitHub</a>.</p>

<h2 id="en-conclusin">En conclusión…</h2>

<p>Mantener un blog en Jekyll tiene muchas ventajas: se puede hostear en cualquier servidor ya que es un generador de sitios estáticos, se puede realizar control de cambios por Git, etc. Y, con un poco de trabajo y una pequeña aplicación web, también se puede hacer accesible la colaboración a cualquier persona, incluso sin conocimientos de GitHub, Jekyll o Markdown. Ahora queda la parte complicada: convencer a más personas para que contribuyan al blog ;)</p>


  <div class="tags">
    
      <a href="/tag/code">code</a>
    
      <a href="/tag/jekyll">jekyll</a>
    
      <a href="/tag/github">github</a>
    
      <a href="/tag/libreim">libreim</a>
    
  </div>
</article>




<nav class="pagination">
  

  <span class="note">1 of 11</span>

  
    <a href="/blog/2/">Older</a>
  

  <a href="/blog/archive">All posts</a>
</nav>

<style>
.wrapper .sidebar .side-content .sections .section-blog {
  background: #ffffff;
  color: #000000;
  border-color: #ffffff
}
@media (min-width: 64em) {
  .wrapper .sidebar .side-content .sections .section-blog {
    margin-right: -2rem;
    padding-right: 2rem;
  }
}
</style>

        </div>
      </div>
    </div>
    <link href='https://fonts.googleapis.com/css?family=Source Sans Pro:300,400,400i,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/assets/stylesheets/highlight-friendly.css">
  </body>
</html>
